# 임베딩 에이전트

## 개요

임베딩 에이전트는 문서를 처리하여 임베딩을 생성하고 효율적인 검색을 위해 저장하는 역할을 합니다.

## 작동 방식

1. **텍스트 추출**: PDF 파일에서 텍스트를 추출합니다.
2. **텍스트 분할**: LLM을 사용하여 텍스트를 논리적인 섹션으로 나눕니다.
3. **텍스트 청크화**: 토큰 기반 청크로 텍스트를 분할합니다.
4. **임베딩 생성**: EmbeddingService를 사용하여 임베딩을 생성합니다.
5. **데이터 저장**: PostgreSQL에 청크를 저장하고 ChromaDB에 임베딩을 저장합니다.

## 사용 기술 및 도구

- **PyPDF**: PDF 파일에서 텍스트 추출.
- **LLM 서비스**: 논리적 섹션 분할 및 요약.
- **EmbeddingService**: 임베딩 생성.
- **PostgreSQL**: 문서 청크 저장.
- **ChromaDB**: 임베딩 저장.
- **SQLAlchemy**: 데이터베이스 상호작용.

## 주요 구성 요소

- **스키마(Schemas)**: 입력 및 출력 구조 정의.
- **프롬프트(Prompts)**: 섹션 분할 및 요약 프롬프트 포함.
- **토크나이저(Tokenizer)**: 토큰 기반 텍스트 청크화 처리.

## 주요 파일

- `agent.py`: 임베딩 에이전트의 주요 구현 파일.

## 평가 방법

### 결과물 평가 기준

1. **텍스트 추출 품질 (Text Extraction Quality)**
   - PDF에서 텍스트를 정확하게 추출했는가?
   - 포맷팅, 테이블, 수식 등을 올바르게 처리했는가?
   - 평가 지표: 추출된 텍스트의 가독성, 문자 정확도

2. **청크 분할 품질 (Chunking Quality)**
   - 논리적 섹션으로 적절하게 분할되었는가?
   - 토큰 기반 청크가 의미 단위를 유지하는가?
   - 평가 지표: 청크 크기 분포, 의미 일관성

3. **메타데이터 정확성 (Metadata Accuracy)**
   - filename, document_title이 정확하게 저장되었는가?
   - document_id가 올바르게 연결되었는가?
   - 평가 지표: 메타데이터 완성도, 정확도

4. **임베딩 품질 (Embedding Quality)**
   - 생성된 임베딩이 의미적 유사도를 잘 표현하는가?
   - ChromaDB에 올바르게 저장되었는가?
   - 평가 지표: 임베딩 차원, 검색 성능

5. **처리 성공률 (Processing Success Rate)**
   - 전체 페이지 중 성공적으로 처리된 비율
   - 오류 없이 완료되었는가?
   - 평가 지표: 처리 성공률, 오류율

### 평가 프로세스

```python
# 평가 예시
result = {
    "total_pages": 150,            # 총 페이지 수
    "processed_pages": 148,        # 처리된 페이지
    "total_chunks": 450,           # 생성된 청크 수
    "embeddings_generated": 450,   # 생성된 임베딩 수
    "avg_chunk_size": 512,         # 평균 청크 크기 (토큰)
    "processing_success_rate": 0.987,  # 148/150 = 98.7%
    "metadata_completeness": 1.0,  # 모든 메타데이터 포함
    "overall_score": 0.95          # 종합 점수
}
```

### 품질 기준

- **후수 (>95%)**: 거의 모든 페이지 처리 성공, 정확한 메타데이터
- **양호 (85-95%)**: 대부분 처리 성공, 일부 메타데이터 누락
- **개선 필요 (<85%)**: 상당한 처리 실패 또는 메타데이터 문제
